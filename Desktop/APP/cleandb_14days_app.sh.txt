#!/bin/bash

# Lấy ngày hiện tại
current_date=$(date +%Y-%m-%d)

# Lấy ngày cuối cùng của tháng
last_day=$(date -d "$(date +%Y-%m-01) +1 month -1 day" +'%Y-%m-%d')

# Lấy ngày 16 của tháng
sixteenth_day=$(date -d "$(date +%Y-%m-01) +15 days" +'%Y-%m-%d')

# Đường dẫn tới file log
log_file="cleandb_history_app.txt"

# Kiểm tra nếu ngày hiện tại là từ ngày 16 đến cuối tháng
if [ "$current_date" -ge "$sixteenth_day" ] && [ "$current_date" != "$last_day" ]; then
    # Backup hoặc thực hiện hành động cần thiết vào ngày 16 đến cuối tháng
    echo "Backup hoặc thực hiện hành động cần thiết vào ngày 16 đến cuối tháng" >> "$log_file"
fi

# Giữ lại trong 15 ngày
# Xóa các file hoặc thực hiện hành động cần thiết cho các file có ngày tạo là trước 15 ngày so với ngày hiện tại
deleted_files=$(find . -maxdepth 1 -type f -name "backup_*" -mtime +15 -exec rm {} \; -print)
if [ -n "$deleted_files" ]; then
    echo "Đã xóa các file backup cũer: $deleted_files" >> "$log_file"
else
    echo "Không có file nào được xóa." >> "$log_file"
fi
